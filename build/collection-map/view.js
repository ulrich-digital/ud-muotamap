(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.apiFetch;var o=e.n(t);let n=[47.0207,8.6523],a=[...n];const r=[[46.591,7.917],[47.434,9.219]],s='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38 48" class="custom-marker"> <path class="custom-marker-svg" d="M19 48s16.3-17.7 16.3-27.2c0-9-7.4-16.3-16.5-16.2-8.9 0-16.2 7.3-16.2 16.2C2.6 30.3 18.9 48 18.9 48Zm0-32.7c3 0 5.4 2.4 5.4 5.4S22 26.1 19 26.1c-3 0-5.4-2.4-5.4-5.4 0-3 2.4-5.4 5.4-5.4Z"/></svg>',l=L.divIcon({html:s,className:"custom-icon-wrapper",iconSize:[38,48],iconAnchor:[19,48],popupAnchor:[0,-48]}),c='<svg class="ampelmann_bewegt_svg" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 50 50">\n  <path id="beinhinten" d="M12.4,43.8c-.2-.5-.5-1.2-.7-1.7-.1-.2,0-.5.2-.7.7-.6,4.2-3.4,4.2-3.4,0,0,5.9-5.1,7.4-6.3s1.2-.9,1.6-1.4c1.8-1.9,1.8-5,0-6.9s-4.4-1.9-6.3-.5c-.2.1-.4.3-.6.5h0s-.1.2-.2.3c-.3.4-.6.8-.8,1.2-1.1,1.7-2.5,3.4-6.8,8-4.7,4.9-5.6,5.9-5.8,6.4-.2.4-.2.8,0,1.1.6,1.3,6.3,6.6,7.9,7.4.7.4,1,0,.9-.8,0,0-.4-1.8-1-3.2Z"/>\n  <path id="beinvorne" d="M42.3,39c-.5.2-1.2.5-1.7.7-.2,0-.5,0-.7-.2-.6-.7-3.4-4.2-3.4-4.2,0,0-5.1-5.9-6.3-7.4s-.9-1.2-1.4-1.6c-1.9-1.8-5-1.8-6.9,0s-1.9,4.4-.5,6.3c.1.2.3.4.5.6h0s.2,0,.3.2c.4.3.8.6,1.2.8,1.7,1.1,3.4,2.5,8,6.8,4.9,4.7,5.9,5.6,6.4,5.8.4.2.8.2,1.1,0,1.3-.6,6.6-6.3,7.4-7.9.4-.7,0-1-.8-.9,0,0-1.8.4-3.2,1Z"/>\n  <path id="oberkorper" d="M30.3,4.4c2.3-1.6,3.7-2.8,3.5-3-.4-.6-1.9-.8-4.8.6-2-1.8-5.2-1.9-7.8-.2,0,0,0,0,0,0-.1-.2-.4-.2-.7,0-.3.2-.4.5-.3.7,0,0,0,0,0,0-2.4,2.1-3.3,5.2-2.3,7.6-.6.8-.7,1.2-.4,1.6.2.4.6.4,1.4,0,.2.2.5.4.7.5-.4.2-.7.2-1.2.2.3.4,1.1.6,1.8.6-.3.2-.9.5-1.2.3.6.4,1.2.3,1.9,0,0,.4-.4.6-.7.8.6,0,1.2-.2,1.7-.5,0,0,0,0,0,0,0,.2-.6,1-1.4,2.4-.3-.2-.6-.3-.9-.3-2.4-.4-5.1,3.3-5.5,5.8-.5,2.6.6,5.1,2.5,6.4.7,4.6,6,5.7,9.7,4.3,4.2-1.5,6-5.9,5-10.9-.4-1.9-1.9-3.8-2.9-5.4.2-.8,1-1,1.3-1.1,1.3-.5,3-1.5,2.9-3,0-1.5-.4-2.8-.4-2.8,0,0,1.5-1.1,1.4-1.4-.1-.4-2.6-1.3-3.3-3.2Z"/>\n</svg>';function i(e,t){if(t.length>0){const o=L.latLngBounds(t),n=window.innerWidth<800?[20,20]:[100,100];e.fitBounds(o,{padding:n})}else{const t=[47.0064174,8.6322735],o=13;e.setView(t,o)}}async function u(e){console.log(e);const{latitude:t,longitude:o,title:n,text:a,image:r,linkedContent:l,permalinkProjekt:i,pageTitle:u}=e;let p="content_above_image";l&&(p+=" has-linked-content"),r&&(p+=" has-image");let m=`<div class="popup_buttons">\n\t\t<button class="button route" data-lat="${t}" data-lng="${o}">${c}</button>\n\t\t<button class="button single_marker active" data-lat="${t}" data-lng="${o}">${s}</button>\n\t</div>`;m+='<div class="card">',m+=`<div class="${p}">`;var d="";if(l){const[e,t]=l.split("-"),{link:o,date:n}=await g(e,t);d=o}return m+=`<p class="projekt_link"><a href="${i}"><i class="fa-sharp fa-regular fa-arrow-down-right arrow_before_text"></i>${u}</a></p>`,m+=`<h3>${n}</h3>`,m+=`<p>${a}</p>`,m+="</div>",r&&(m+='<div class="image_container">',m+=`<figure><img src="${r}" alt="${n}" style="max-width: 100%; height: auto;" /></figure>`,m+='<svg class="post_overlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 409.584 111.466" preserveAspectRatio="none"><path d="M0,0V111.466C169.415,95.866,219.838-22.334,409.584,18.487V0Z"></path></svg>',m+="</div>"),l&&""!=d&&(m+=`<div class="wave_button"><a class="post_link" href="${d}"><i class="fa-sharp fa-regular fa-arrow-down-right arrow_before_text"></i>Mehr</a><svg class="overlay_bottom" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 293.702 77.466" preserveAspectRatio="none"><path class="button_wave" d="M0,77.4c38.3-2.6,73.7-6.1,129.2-35C169.1,21.7,198.4,0,249.4,0c14.9,0,29.7,1.5,44.3,4.8v72.7H0Z"></path></svg></div>`),m+="</div>",m}function p(e,t){e.classList.add("has_active_marker"),e.querySelectorAll(".custom-marker").forEach((e=>{e.classList.remove("active")}));const o=t.getElement().querySelector(".custom-marker");if(o){const n=o.classList.toggle("active");e._activeMarker=n?t:null,n&&(t.openPopup(),function(e){e.querySelectorAll(".cloned-leaflet-popup").forEach((e=>{e.querySelectorAll("[style]").forEach((e=>{e.removeAttribute("style")}))}))}(e))}}function m(e){e.querySelectorAll(".cloned-leaflet-popup").forEach((e=>{e.remove()}))}function d(e){const t=e.getContainer();t.classList.remove("has_active_route"),t.querySelectorAll(".button.route").forEach((e=>{e.classList.remove("active")})),t.querySelectorAll(".button.single_marker").forEach((e=>{e.classList.add("active")})),e&&e instanceof L.Map&&e._routeControl&&(e._routeControl.remove(),e._routeControl=null)}function v(e){e._ampelmannMarker&&(e._ampelmannMarker.remove(),e._ampelmannMarker=null,function(e){e._simulationInterval&&(clearInterval(e._simulationInterval),e._simulationInterval=null)}(e))}document.addEventListener("DOMContentLoaded",(()=>{function e(){return"undefined"!=typeof L&&L.Routing&&"function"==typeof L.Routing.control}document.querySelectorAll(".wp-block-muotamap-collection-map").forEach((t=>{if(document.body.classList.contains("is-admin")||t.closest(".editor-styles-wrapper"));else{let o=[];function a(t){t._leaflet_id||t._mapInstance||async function(){try{const a=await fetch("/wp-json/custom/v1/all-pages-markers");if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);o=await a.json();const s=[],g=L.map(t);t._mapInstance=g,L.tileLayer("https://api.mapbox.com/styles/v1/ulrichdigital/cm42iduyt00x101r20fa19tlr/tiles/512/{z}/{x}/{y}?access_token=pk.eyJ1IjoidWxyaWNoZGlnaXRhbCIsImEiOiJjbTQyaTk1ZjMwMHc1MmpxdzNwb2gzcnJ5In0.dNCkyJW5SkOCLz0_hGLMxA",{attribution:'&copy; <a href="https://www.mapbox.com/">Mapbox</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',tileSize:512,zoomOffset:-1,detectRetina:!0}).addTo(g);for(const e of o){const{latitude:o,longitude:n}=e,a=L.marker([o,n],{icon:l}).addTo(g);s.push([o,n]),g.on("popupopen",(e=>{const t=e.popup._container,o=g.getContainer();if(o&&t){o.querySelectorAll(".cloned-leaflet-popup").forEach((e=>e.remove()));const e=t.cloneNode(!0);e.removeAttribute("style"),e.classList.remove("leaflet-popup"),e.classList.remove("leaflet-zoom-animated"),e.classList.add("cloned-leaflet-popup"),e.querySelectorAll("[style]").forEach((e=>{e.removeAttribute("style")})),o.appendChild(e)}})),a.on("click",(function(o){p(t,a),m(t),v(t._mapInstance),d(t._mapInstance),u(e).then((e=>{a.bindPopup(e,{closeOnMove:!1,autoClose:!1,closeOnClick:!1}),a.openPopup()})).catch((e=>{console.error("Fehler beim Generieren des Popup-Inhalts:",e)}))}))}t.addEventListener("click",(o=>{const a=o.target.closest(".button.route");a&&function(t){if(e())t();else{const o=setInterval((()=>{e()&&(clearInterval(o),t())}),50)}}((()=>{!function(e,t){const o=e.getContainer();o.classList.add("has_active_route"),o.querySelectorAll(".button.single_marker").forEach((e=>{e.classList.remove("active")})),t.classList.add("active");const a=parseFloat(t.dataset.lat),r=parseFloat(t.dataset.lng),s=L.Routing.control({waypoints:[L.latLng(n),L.latLng(a,r)],addWaypoints:!1,fitSelectedRoutes:!0,showAlternatives:!1,routeWhileDragging:!1,routeDragInterval:200,serviceUrl:"http://router.project-osrm.org/route/v1",lineOptions:{styles:[{color:"#964226",weight:8,opacity:.8}],addWaypoints:!1},createMarker:function(e,t,o){return null}});e._routeControl=s.addTo(e)}(t._mapInstance,a),function(e){const t=L.divIcon({html:c,className:"imhere-icon-wrapper init",iconSize:[50,50],iconAnchor:[25,50],popupAnchor:[0,-50]});e._ampelmannMarker=L.marker(n,{icon:t}).addTo(e);const o=e._ampelmannMarker.getElement();o&&o.classList.remove("init"),function(e){navigator.geolocation?navigator.geolocation.watchPosition((t=>{n=[t.coords.latitude,t.coords.longitude],h(e),w(e._mapInstance,r,n)}),(e=>{}),{enableHighAccuracy:!0,maximumAge:1e3,timeout:2e3}):(console.warn("Geolocation wird simuliert."),function(e){e._simulationInterval||(e._simulationInterval=setInterval((()=>{n[0]+=.01*(Math.random()-.5),n[1]+=.01*(Math.random()-.5),h(e),w(e,r,n)}),2e3))}(e))}(e)}(t._mapInstance)})),o.target.closest(".button.single_marker")&&(v(t._mapInstance),d(t._mapInstance),function(e){const t=e._mapInstance;if(!t)return;let o=null;if(t.eachLayer((function(e){e instanceof L.Marker&&e.getElement&&e.getElement().querySelector("svg.active")&&(o=e)})),o){const e=o.getLatLng();t.setView(e,t.getZoom())}}(t))}));const f=L.Control.extend({options:{position:"topleft"},onAdd:function(e){const t=L.DomUtil.create("div","leaflet-bar custom-control leaflet-control-map_reset_container"),o=L.DomUtil.create("a","custom-control-button leaflet_control-map_reset",t);o.title="Karte zentrieren",o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet" aria-hidden="true" role="img"><path d="M55.7 199.7L96 240l48 0 48 48 0 64 32 32 0 64 64 0 0-48 64-64 0-80-128 0-32-32 0-32 80 0 0-32-32-32 0-16 32-32 0-31.4c-5.3-.4-10.6-.6-16-.6C160.6 48 80.3 112.2 55.7 199.7zM464 256c0-36.9-9.6-71.5-26.4-101.6L400 192l0 80 63.4 0c.4-5.3 .6-10.6 .6-16zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z"/></svg>';const n=e.getContainer();return n._mapInstance=e,L.DomEvent.on(o,"click",(function(t){L.DomEvent.stopPropagation(t),L.DomEvent.preventDefault(t),i(e,s),d(e),v(e),function(e){e.querySelectorAll(".leaflet-marker-icon .active").forEach((e=>{e.classList.remove("active")}))}(n),m(n)})),t}});g.addControl(new f),i(g,s),g.on("click",(function(e){}))}catch(e){console.error("Fehler beim Abrufen der Marker:",e)}}()}a(t)}}))}));const g=async(e,t)=>{try{const n=await o()({path:`/wp/v2/${e}/${t}`}),{date:a,link:r}=n;return{date:f(a),link:r}}catch(e){return console.error("Fehler beim Abrufen des Posts:",e),null}},f=e=>{const t=new Date(e);return new Intl.DateTimeFormat("de-DE",{day:"numeric",month:"long",year:"numeric"}).format(t)};function h(e){e._ampelmannMarker&&(n[1]<a[1]?e._ampelmannMarker.getElement().classList.add("nase_links"):e._ampelmannMarker.getElement().classList.remove("nase_links"),e._ampelmannMarker.setLatLng(n),e._routeControl&&e._routeControl.setWaypoints([L.latLng(n),e._routeControl.getWaypoints()[1].latLng]),a=[...n])}function w(e,t,o){const[n,a]=o,r=t[0],s=t[1];let l=!1;n<r[0]&&(r[0]=n,l=!0),a<r[1]&&(r[1]=a,l=!0),n>s[0]&&(s[0]=n,l=!0),a>s[1]&&(s[1]=a,l=!0),l&&(e.setMaxBounds(t),e.fitBounds(t))}})();