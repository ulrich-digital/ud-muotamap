(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.apiFetch;var r=e.n(n);const a=window.wp.blocks,l=window.wp.element,o=window.wp.blockEditor,c=window.wp.components,s=window.wp.data,i=["posts"];(0,a.registerBlockType)("muotamap/single-map",{title:"Single Map",icon:"location-alt",category:"muotamaps",description:"Dieser Block stellt eine Karte mit Markern dar. Diese können mit Magazinbeiträgen verlinkt und mit Text und Bilder ergänzt werden. Sie sind mit einer Geotargeting-Funktion ausgestattet.",attributes:{latitude:{type:"number",default:47.0064174},longitude:{type:"number",default:8.6322735},zoom:{type:"number",default:13},markers:{type:"array",default:[]}},example:{attributes:{latitude:47.0064174,longitude:8.6322735,zoom:15,markers:[{latitude:47.009715,longitude:8.617963},{latitude:47.011441,longitude:8.643498}]}},edit:({attributes:e,setAttributes:n,clientId:a})=>{const{latitude:u,longitude:d,zoom:m,markers:p=[]}=e,g=(0,l.useRef)(null),v=(0,l.useRef)(null),[f,h]=(0,l.useState)(!1),[w,k]=(0,l.useState)(null),b=(0,l.useRef)(null),E=(0,l.useRef)(null),y=(0,l.useRef)(null),[C,M]=(0,l.useState)([{label:"None",value:""}]),_=(0,l.useRef)([]),[x,z]=(0,l.useState)(!1),[B,S]=(0,l.useState)(null),[N,D]=(0,l.useState)(null),[$,A]=(0,l.useState)(!1),{selectBlock:T}=(0,s.useDispatch)("core/block-editor"),P=(0,l.useRef)(!1),R=(0,s.useSelect)((e=>e("core/block-editor").isBlockSelected(a)),[a]),Z=(0,o.useBlockProps)({className:R?"wp-block-muotamap is-selected":"wp-block-muotamap"});function q(e){e._hasClickEvent||(e.on("click",(e=>{const t=e.originalEvent?.target;I(v.current.getContainer());const n=t.closest(".custom-marker");n&&n.classList.add("active")})),e._hasClickEvent=!0)}function I(e){e.querySelectorAll(".custom-marker").forEach((e=>{e.classList.remove("active")}))}const O=async(e,t,n)=>{let a=null,l=null;t&&t.popup?(a=t.popup,l=a._container):(e&&"function"==typeof e.getCenter&&e.openPopup("<p>dummy</p>",n),a=e._popup,a&&(l=a._container));const o=e.getContainer(),c=p.findIndex((e=>e.latitude===a._latlng.lat&&e.longitude===a._latlng.lng));if(-1!==c){const{latitude:e,longitude:t,title:n,text:l,image:o,linkedContent:d}=p[c];let m="content_above_image";d&&(m+=" has-linked-content"),o&&(m+=" has-image");var s="",i="",u="";const g=window.location.origin,v=async(e,t)=>{try{const n=await r()({path:`/wp/v2/${e}/${t}`}),{date:a,link:l}=n;return{date:f(a),link:l}}catch(e){return console.error("Fehler beim Abrufen des Posts:",e),null}},f=e=>{const t=new Date(e);return new Intl.DateTimeFormat("de-DE",{day:"numeric",month:"long",year:"numeric"}).format(t)};if(d){const[e,t]=d.split("-");try{const{link:n,date:r}=await v(e,t);s=n,i=r,u=`${g}/wp-admin/post.php?post=${t}&action=edit`}catch(e){console.error("Fehler beim Abrufen des Permalinks:",e)}}let h='<div class="popup_buttons">';h+='<div class="button edit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M454.6 45.3l12.1 12.1c12.5 12.5 12.5 32.8 0 45.3L440 129.4 382.6 72l26.7-26.7c12.5-12.5 32.8-12.5 45.3 0zM189 265.6l171-171L417.4 152l-171 171c-4.2 4.2-9.6 7.2-15.4 8.6l-65.6 15.1L180.5 281c1.3-5.8 4.3-11.2 8.6-15.4zm197.7-243L166.4 243c-8.5 8.5-14.4 19.2-17.1 30.9l-20.9 90.6c-1.2 5.4 .4 11 4.3 14.9s9.5 5.5 14.9 4.3l90.6-20.9c11.7-2.7 22.4-8.6 30.9-17.1L489.4 125.3c25-25 25-65.5 0-90.5L477.3 22.6c-25-25-65.5-25-90.5 0zM80 64C35.8 64 0 99.8 0 144L0 432c0 44.2 35.8 80 80 80l288 0c44.2 0 80-35.8 80-80l0-128c0-8.8-7.2-16-16-16s-16 7.2-16 16l0 128c0 26.5-21.5 48-48 48L80 480c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48l128 0c8.8 0 16-7.2 16-16s-7.2-16-16-16L80 64z"/></svg></div>',h+='<div class="button delete"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M164.2 39.5L148.9 64l150.3 0L283.8 39.5c-2.9-4.7-8.1-7.5-13.6-7.5l-92.5 0c-5.5 0-10.6 2.8-13.6 7.5zM311 22.6L336.9 64 384 64l32 0 16 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-16 0 0 336c0 44.2-35.8 80-80 80l-224 0c-44.2 0-80-35.8-80-80L32 96 16 96C7.2 96 0 88.8 0 80s7.2-16 16-16l16 0 32 0 47.1 0L137 22.6C145.8 8.5 161.2 0 177.7 0l92.5 0c16.6 0 31.9 8.5 40.7 22.6zM64 96l0 336c0 26.5 21.5 48 48 48l224 0c26.5 0 48-21.5 48-48l0-336L64 96zm80 80l0 224c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-224c0-8.8 7.2-16 16-16s16 7.2 16 16zm96 0l0 224c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-224c0-8.8 7.2-16 16-16s16 7.2 16 16zm96 0l0 224c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-224c0-8.8 7.2-16 16-16s16 7.2 16 16z"/></svg></div>',h+=`<div class="button route" data-lat="${e}" data-lng="${t}"><svg class="ampelmann_bewegt_svg" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 50 50">\n  <path id="beinhinten" d="M12.4,43.8c-.2-.5-.5-1.2-.7-1.7-.1-.2,0-.5.2-.7.7-.6,4.2-3.4,4.2-3.4,0,0,5.9-5.1,7.4-6.3s1.2-.9,1.6-1.4c1.8-1.9,1.8-5,0-6.9s-4.4-1.9-6.3-.5c-.2.1-.4.3-.6.5h0s-.1.2-.2.3c-.3.4-.6.8-.8,1.2-1.1,1.7-2.5,3.4-6.8,8-4.7,4.9-5.6,5.9-5.8,6.4-.2.4-.2.8,0,1.1.6,1.3,6.3,6.6,7.9,7.4.7.4,1,0,.9-.8,0,0-.4-1.8-1-3.2Z"/>\n  <path id="beinvorne" d="M42.3,39c-.5.2-1.2.5-1.7.7-.2,0-.5,0-.7-.2-.6-.7-3.4-4.2-3.4-4.2,0,0-5.1-5.9-6.3-7.4s-.9-1.2-1.4-1.6c-1.9-1.8-5-1.8-6.9,0s-1.9,4.4-.5,6.3c.1.2.3.4.5.6h0s.2,0,.3.2c.4.3.8.6,1.2.8,1.7,1.1,3.4,2.5,8,6.8,4.9,4.7,5.9,5.6,6.4,5.8.4.2.8.2,1.1,0,1.3-.6,6.6-6.3,7.4-7.9.4-.7,0-1-.8-.9,0,0-1.8.4-3.2,1Z"/>\n  <path id="oberkorper" d="M30.3,4.4c2.3-1.6,3.7-2.8,3.5-3-.4-.6-1.9-.8-4.8.6-2-1.8-5.2-1.9-7.8-.2,0,0,0,0,0,0-.1-.2-.4-.2-.7,0-.3.2-.4.5-.3.7,0,0,0,0,0,0-2.4,2.1-3.3,5.2-2.3,7.6-.6.8-.7,1.2-.4,1.6.2.4.6.4,1.4,0,.2.2.5.4.7.5-.4.2-.7.2-1.2.2.3.4,1.1.6,1.8.6-.3.2-.9.5-1.2.3.6.4,1.2.3,1.9,0,0,.4-.4.6-.7.8.6,0,1.2-.2,1.7-.5,0,0,0,0,0,0,0,.2-.6,1-1.4,2.4-.3-.2-.6-.3-.9-.3-2.4-.4-5.1,3.3-5.5,5.8-.5,2.6.6,5.1,2.5,6.4.7,4.6,6,5.7,9.7,4.3,4.2-1.5,6-5.9,5-10.9-.4-1.9-1.9-3.8-2.9-5.4.2-.8,1-1,1.3-1.1,1.3-.5,3-1.5,2.9-3,0-1.5-.4-2.8-.4-2.8,0,0,1.5-1.1,1.4-1.4-.1-.4-2.6-1.3-3.3-3.2Z"/>\n</svg></div>`,h+="</div>",h+='<div class="card">',h+=`<div class="${m}">`,d&&(h+="<div class=first_row>",h+=`<p class="post-date">${i}</p>`,h+=`<div class="edit_post"><a href="${u}" target="_blank" class="post-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false"><path d="M19.5 4.5h-7V6h4.44l-5.97 5.97 1.06 1.06L18 7.06v4.44h1.5v-7Zm-13 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-3H17v3a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h3V5.5h-3Z"></path></svg></a></div>`,h+="</div>"),h+=`<h3>${n||"Kein Titel"}</h3>`,h+=`<p>${l||"Kein Text verfügbar"}</p>`,h+="</div>",o&&(h+='<div class="image_container">',h+=`<figure><img src="${o}" alt="${n||"Marker-Bild"}" style="max-width: 100%; height: auto;" /></figure>`,h+='<svg class="post_overlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 409.584 111.466" preserveAspectRatio="none"><path d="M0,0V111.466C169.415,95.866,219.838-22.334,409.584,18.487V0Z"></path></svg>',h+="</div>"),d&&(h+=`<div class="wave_button">\n\t\t\t\t\t\t<a class="post_link" href="${s}" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M328 416l24 0 0-24 0-240 0-24-48 0 0 24 0 182.1L81 111l-17-17L30.1 128l17 17 223 223L88 368l-24 0 0 48 24 0 240 0z"/></svg>Mehr</a>\n\t\t\t\t\t\t<svg class="overlay_bottom" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 293.702 77.466" preserveAspectRatio="none"><path class="button_wave" d="M0,77.4c38.3-2.6,73.7-6.1,129.2-35C169.1,21.7,198.4,0,249.4,0c14.9,0,29.7,1.5,44.3,4.8v72.7H0Z"></path></svg>\n\t\t\t\t\t</div>`),h+="</div>",a.setContent(h)}if(o&&l){o.querySelectorAll(".cloned-leaflet-popup").forEach((e=>e.remove()));const e=l.cloneNode(!0);e.removeAttribute("style"),e.classList.remove("leaflet-popup"),e.classList.remove("leaflet-zoom-animated"),e.classList.add("cloned-leaflet-popup"),o.appendChild(e),o.querySelectorAll(".cloned-leaflet-popup").forEach((e=>{e.querySelectorAll("[style]").forEach((e=>{e.removeAttribute("style")}))}))}},[F,H]=(0,l.useState)(null);(0,l.useEffect)((()=>{if("undefined"!=typeof L){const e=L.divIcon({html:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38 48" class="custom-marker"> <path class="custom-marker-svg" d="M19 48s16.3-17.7 16.3-27.2c0-9-7.4-16.3-16.5-16.2-8.9 0-16.2 7.3-16.2 16.2C2.6 30.3 18.9 48 18.9 48Zm0-32.7c3 0 5.4 2.4 5.4 5.4S22 26.1 19 26.1c-3 0-5.4-2.4-5.4-5.4 0-3 2.4-5.4 5.4-5.4Z"/></svg>',className:"custom-icon-wrapper",iconSize:[38,48],iconAnchor:[19,48],popupAnchor:[0,-48]});H(e)}}),[]),(0,l.useEffect)((()=>{(async()=>{try{const e=[];for(const t of i){const n=(await r()({path:`/wp/v2/${t}?per_page=100`})).map((e=>({label:`${e.title.rendered}`,value:`${t}-${e.id}`})));e.push(...n)}M([{label:"None",value:""},...e])}catch(e){}})()}),[]),(0,l.useEffect)((()=>{if(!v.current&&g.current&&F){const e=L.latLngBounds();v.current=L.map(g.current,{center:[u,d],zoom:m,dragging:!1,inertia:!0}),L.tileLayer("https://api.mapbox.com/styles/v1/ulrichdigital/cm42iduyt00x101r20fa19tlr/tiles/512/{z}/{x}/{y}?access_token=pk.eyJ1IjoidWxyaWNoZGlnaXRhbCIsImEiOiJjbTQyaTk1ZjMwMHc1MmpxdzNwb2gzcnJ5In0.dNCkyJW5SkOCLz0_hGLMxA",{attribution:'&copy; <a href="https://www.mapbox.com/">Mapbox</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',tileSize:512,zoomOffset:-1,detectRetina:!0,maxZoom:19}).addTo(v.current),L.Marker.prototype.options.icon=F,p.forEach((({latitude:t,longitude:n,title:r},a)=>{const l=L.marker([t,n]).addTo(v.current);_.current[a]=l,e.extend([t,n]),q(l),r&&l.bindPopup(r)})),p.length>0&&v.current.fitBounds(e,{padding:[50,50]})}A(!0)}),[u,d,m,p,F]),(0,l.useEffect)((()=>{if(!$||!v.current)return;const e=e=>O(v.current,e);return v.current.on("popupopen",e),()=>{v.current.off("popupopen",e)}}),[$,p]),(0,l.useEffect)((()=>{if(f&&null!==w&&p[w]){const{latitude:e,longitude:t}=p[w];b.current?(b.current.setView([e,t]),y.current.setLatLng([e,t])):(b.current=L.map(E.current).setView([e,t],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors",maxZoom:19}).addTo(b.current),y.current=L.marker([e,t],{icon:F,draggable:!0}).addTo(b.current).on("dragend",(e=>{const{lat:t,lng:r}=e.target.getLatLng(),a=[...p];if(a[w]={...a[w],latitude:t,longitude:r},n({markers:a}),v.current){const e=_.current[w];if(e){e.setLatLng([t,r]);const n=e.getElement();if(n){I(v.current.getContainer());const e=n.querySelector(".custom-marker");e&&e.classList.add("active")}const l=L.latLngBounds();a.forEach((({latitude:e,longitude:t})=>{l.extend([e,t])})),v.current.setView([t,r]),v.current.fitBounds(l,{padding:[50,50]})}}})))}return()=>{!f&&b.current&&(b.current.remove(),b.current=null,y.current=null)}}),[f,w,p]);const V=(0,l.useRef)(null);(0,l.useEffect)((()=>{if(!$||!v.current||!F)return;if(f)return void(V.current&&(v.current.removeControl(V.current),V.current=null));if(V.current)return;const e=new(L.Control.extend({options:{position:"bottomright"},onAdd:function(e){const t=L.DomUtil.create("div","custom-control leaflet-control-add-marker"),r=L.DomUtil.create("a","custom-control-button",t);return r.href="#",r.title="Marker hinzufügen",r.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM168 280l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"/></svg>\n        Marker hinzufügen',L.DomEvent.on(r,"click",(t=>{L.DomEvent.stopPropagation(t),L.DomEvent.preventDefault(t);const r=e.getCenter(),a={title:`Marker ${p.length+1}`,latitude:r.lat,longitude:r.lng,text:"",image:"",linkedContent:""},l=[...p,a];n({markers:l});const o=L.marker([a.latitude,a.longitude],{icon:F}).addTo(v.current).bindPopup(a.title||`Marker ${l.length}`);_.current.push(o),k(l.length-1),h(!0)})),L.DomEvent.disableClickPropagation(t),L.DomEvent.disableScrollPropagation(t),t}}));return v.current.addControl(e),V.current=e,()=>{v.current&&V.current&&(v.current.removeControl(V.current),V.current=null)}}),[$,F,f,p]);const U=(0,l.useRef)(null);return(0,l.useEffect)((()=>{if(v.current){U.current&&(v.current.removeControl(U.current),U.current=null);const e=L.Control.extend({options:{position:"topleft"},onAdd:function(e){const t=L.DomUtil.create("div","leaflet-bar custom-control leaflet-control-map_reset_container leaflet-control"),n=L.DomUtil.create("a","custom-control-button leaflet_control-map_reset",t);return n.title="Karte zentrieren",n.style.outlineStyle="none",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet" aria-hidden="true" role="img"><path d="M55.7 199.7L96 240l48 0 48 48 0 64 32 32 0 64 64 0 0-48 64-64 0-80-128 0-32-32 0-32 80 0 0-32-32-32 0-16 32-32 0-31.4c-5.3-.4-10.6-.6-16-.6C160.6 48 80.3 112.2 55.7 199.7zM464 256c0-36.9-9.6-71.5-26.4-101.6L400 192l0 80 63.4 0c.4-5.3 .6-10.6 .6-16zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z"/></svg>',L.DomEvent.on(n,"click",(t=>{L.DomEvent.stopPropagation(t),L.DomEvent.preventDefault(t);const n=v.current.getContainer();if(I(n),function(e){e.querySelectorAll(".cloned-leaflet-popup").forEach((e=>{e.remove()}))}(n),p.length>0){const t=L.latLngBounds(p.map((({latitude:e,longitude:t})=>[e,t])));e.fitBounds(t,{padding:[50,50]})}})),t}}),t=new e;v.current.addControl(t),U.current=t}return()=>{U.current&&(v.current.removeControl(U.current),U.current=null)}}),[$,p]),(0,l.useEffect)((()=>{v.current&&_.current&&_.current.forEach((e=>{e&&q(e)}))}),[p]),(0,l.useEffect)((()=>{if(!v.current)return;const e=v.current.getContainer(),t=e=>{const t=e.target.closest(".button.edit"),n=e.target.closest(".button.delete");if(!t&&!n)return;const r=e.target.closest(".leaflet-popup-content");if(!r)return;const a=r.querySelector("h3")?.textContent?.trim(),l=p.findIndex((e=>e.title?.trim()===a));-1!==l&&(t?(h(!0),k(l)):n&&(z(!0),S(l)))};return e.addEventListener("click",t),()=>{e.removeEventListener("click",t)}}),[$,p]),(0,l.useEffect)((()=>{if(!v.current)return;const e=e=>{e.target.closest(".wp-block-muotamap-single-map")&&T(a)},t=v.current.getContainer();return t.addEventListener("click",e),()=>{t.removeEventListener("click",e)}}),[a]),(0,l.useEffect)((()=>{if(!v.current)return;const e=e=>{const t=e.originalEvent?.target;if(!t.closest(".leaflet-marker-icon")&&!t.closest(".button")){const e=t.closest(".wp-block-muotamap-single-map");e&&e.querySelectorAll(".cloned-leaflet-popup").forEach((e=>e.remove()))}I(v.current.getContainer())};return v.current.on("click",e),()=>{v.current?.off("click",e)}}),[]),(0,l.useEffect)((()=>{if(!$||!v.current)return;const e=v.current,t=e.getContainer(),n=()=>{const n=e.dragging?._draggable;n&&n._moving&&"function"==typeof n.finishDrag&&n.finishDrag(),e.dragging.disable(),P.current=!1,t.classList.remove("dragging-on")};n();const r=r=>{var a;(a=r.target)&&!(a.closest(".leaflet-marker-icon")||a.closest(".leaflet-popup")||a.closest(".cloned-leaflet-popup")||a.closest(".button")||a.closest(".leaflet-control")||a.closest(".leaflet-interactive"))&&(P.current?n():(e.dragging.enable(),P.current=!0,t.classList.add("dragging-on")))};return t.addEventListener("pointerdown",r,{capture:!0}),()=>{t.removeEventListener("pointerdown",r,{capture:!0}),n()}}),[$]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(c.PanelBody,{title:"Map Marker",className:"inspector_container_map_markers",initialOpen:!0},p.map(((n,r)=>(0,t.createElement)("div",{key:r,className:"single_marker"},(0,t.createElement)("span",{className:"marker_bezeichnung"},n.title||`Marker ${r+1}`),(0,t.createElement)(c.Button,{className:"edit",onClick:()=>(t=>{null===t||t<0||t>=e.markers.length?console.warn("Ungültiger Marker-Index:",t):(k(t),h(!0))})(r)},(0,t.createElement)("i",{className:"fa-solid fa-pen-to-square"})),(0,t.createElement)(c.Button,{className:"delete",onClick:()=>{S(r),z(!0)}},(0,t.createElement)("i",{className:"fa-solid fa-trash-can"}))))),(0,t.createElement)(c.Button,{variant:"primary",onClick:()=>{const e=v.current.getCenter(),t={title:`Marker ${p.length+1}`,latitude:e.lat,longitude:e.lng,text:"",image:"",linkedContent:""},r=[...p,t];n({markers:r});const a=L.marker([t.latitude,t.longitude],{icon:F}).addTo(v.current).bindPopup(t.title||`Marker ${r.length}`);_.current.push(a),k(r.length-1),h(!0)}}," Marker hinzufügen"))),(0,t.createElement)("div",{...Z,ref:g}),f&&null!==w&&(0,t.createElement)(c.Modal,{title:"Marker bearbeiten",onRequestClose:()=>{if(null!==w){const t=[...p];n({markers:t});const r=_.current[w];if(r&&r.getPopup()){var e=r._latlng;O(v.current,"dummy",e)}}h(!1),k(null)},className:"uldi_openstreetmap_overlay"},(0,t.createElement)("div",{className:"custom-label-wrapper"},(0,t.createElement)("div",{class:"title"},"Position ändern")),(0,t.createElement)("div",{ref:E,className:"uldi_openstreetmap_overlay_map"}),(0,t.createElement)("div",{className:"custom-label-wrapper"},(0,t.createElement)(c.TextControl,{label:"Überschrift",value:p[w]?.title||"",onChange:e=>{const t=[...p];t[w].title=e,n({markers:t})},__nextHasNoMarginBottom:!0})),(0,t.createElement)("div",{className:"custom-label-wrapper"},(0,t.createElement)(c.TextareaControl,{label:"Text",value:p[w]?.text||"",onChange:e=>{const t=[...p];t[w].text=e,n({markers:t})},__nextHasNoMarginBottom:!0})),(0,t.createElement)("div",{className:"custom-label-wrapper"},(0,t.createElement)(c.SelectControl,{label:"(optional) Verlinke einen Magazinbeitrag",value:p[w]?.linkedContent||"",options:C.length>0?C:[{label:"Keine Beiträge gefunden",value:""}],onChange:e=>{const t=[...p];t[w].linkedContent=e,n({markers:t})},__nextHasNoMarginBottom:!0})),p[w]&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"custom-label-wrapper"},(0,t.createElement)("div",{class:"custom_label"},"Bild"),p[w]?.image&&(0,t.createElement)("div",{class:"media_container"},(0,t.createElement)("img",{src:p[w].image,alt:"Marker Image"})),(0,t.createElement)(o.MediaUploadCheck,null,(0,t.createElement)("div",{class:"media_upload_check"},(0,t.createElement)(o.MediaUpload,{onSelect:e=>{if(e?.url){const t=[...p];t[w].image=e.url,n({markers:t})}},allowedTypes:["image"],value:p[w]?.image||"",render:({open:e})=>(0,t.createElement)(c.Button,{variant:"secondary",onClick:e},p[w]?.image?"Bild ändern":"Bild hinzufügen")}),p[w]?.image&&(0,t.createElement)(c.Button,{isDestructive:!0,onClick:()=>{const e=[...p];e[w].image="",n({markers:e})}},"Bild entfernen")))))),x&&(0,t.createElement)(c.Modal,{title:"Marker löschen",onRequestClose:()=>{z(!1)},className:"uldi_openstreetmap_overlay_delete_marker"},(0,t.createElement)("div",{className:"modal-overlay"},(0,t.createElement)("div",{className:"modal"},(0,t.createElement)("p",null,"Sind Sie sicher, dass Sie diesen Marker löschen möchten?"),(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)("button",{type:"button",class:"components-button is-secondary",onClick:()=>z(!1)},"Abbrechen"),(0,t.createElement)("button",{type:"button",class:"components-button is-primary is-warning",onClick:()=>{if(null!==B){const e=[...p];e.splice(B,1),n({markers:e});const t=_.current[B];t&&(v.current.removeLayer(t),_.current.splice(B,1));const r=v.current.getContainer().querySelector(".cloned-leaflet-popup");r&&r.remove(),wp.data.dispatch("core/editor").savePost().then((()=>{window.location.reload()})).catch((e=>{console.error("Fehler beim Speichern:",e)})),z(!1),S(null)}}},"Ja, löschen"))))))},save:({attributes:e})=>{const{latitude:n,longitude:r,zoom:a,markers:l=[]}=e,c=o.useBlockProps.save({className:"wp-block-muotamap wp-block-muotamap-single-map alignwide","data-latitude":n,"data-longitude":r,"data-zoom":a,"data-markers":JSON.stringify(l)});return(0,t.createElement)("div",{...c})}})})();